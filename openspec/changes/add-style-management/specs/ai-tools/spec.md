# AI 工具

## 新增需求

### 需求：基于图生风格描述工具
系统必须使用 OpenRouter LLM 接口根据用户上传的图片和描述生成风格描述设定，用于生图和生视频。

#### 场景：使用 LLM 生成风格描述
- **当** 用户在工具页面使用"图生风格描述"工具
- **且** 上传图片（或粘贴图片、选择素材）并可选提供额外描述
- **且** 点击"生成"按钮
- **则** 系统加载提示词模板文件 `server/prompts/generation/image_to_style_description.txt`
- **且** 将图片编码为 base64 格式
- **且** 如果用户提供了额外描述，将其包含在提示词中
- **且** 从配置文件读取 LLM 配置（模型、API Key）
- **且** 调用 OpenRouter LLM 接口（支持多模态输入：图片 + 文本）
- **且** 返回生成的风格描述文本（100字以内）
- **且** 如果 LLM 调用失败，任务状态标记为失败并返回错误信息
- **且** 生成结果保存到历史记录，包含完整的请求参数、响应 JSON 和提示词

#### 场景：提示词模板管理
- **当** 系统需要生成风格描述时
- **则** 从 `server/prompts/generation/image_to_style_description.txt` 加载提示词模板
- **且** 提示词使用中文编写
- **且** 提示词明确要求返回风格描述（而非内容描述）
- **且** 提示词应说明风格描述用于生图和生视频
- **且** 提示词应包含风格类型示例（三渲二、3D国创、赛璐璐、3D Q版等）
- **且** 提示词应要求详细描述风格特征（色彩、渲染方式、线条、质感等）
- **且** 提示词应限制输出在 100 字以内

#### 场景：多模态输入处理
- **当** 系统需要调用 LLM 接口生成风格描述时
- **则** 将图片文件编码为 base64 格式
- **且** 构建多模态消息（包含图片和文本提示词）
- **且** 如果用户提供了额外描述，将其包含在用户消息中
- **且** 使用 OpenRouter API 的多模态能力处理图片和文本输入

#### 场景：工具界面
- **当** 用户在工具页面
- **且** 点击"图生风格描述"工具卡片（位于"图生描述"工具下面）
- **则** 显示图生风格描述表单
- **且** 表单包含图片上传组件（支持上传、粘贴、选择素材）
- **且** 表单包含可选描述输入框
- **当** 用户上传图片（或粘贴图片、选择素材）并可选输入描述
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的风格描述
- **且** 生成结果保存到历史记录

#### 场景：历史记录展示
- **当** 用户在工具页面查看历史记录
- **且** 历史记录类型为"图生风格描述"
- **则** 显示输入图片预览
- **且** 显示生成的风格描述文本
- **且** 点击"查看详情"可查看完整的请求参数、响应 JSON 和提示词

