# 风格管理

## Purpose
风格管理提供用户创建、编辑和删除风格模板的功能。风格模板包含名称、描述和参考图片，用于在创建作品时快速应用风格设定。

## 新增需求

### 需求：风格列表管理
系统必须提供风格列表页面，用户可以：
- 查看所有风格
- 创建新风格
- 编辑现有风格
- 删除风格

#### 场景：查看风格列表
- **当** 用户导航到风格管理页面
- **则** 所有风格以网格形式显示
- **且** 每个风格显示参考图片（如果有）、名称和描述预览
- **且** 每个风格有"编辑"和"删除"操作可用

#### 场景：创建新风格
- **当** 用户在风格管理页面点击"创建新风格"按钮
- **且** 填写风格名称、风格描述，并可选上传参考图片
- **且** 如果上传了参考图片，可以点击"生成风格描述"按钮
- **则** 系统调用"图生风格描述"接口，生成风格描述
- **且** 生成的描述自动填充到风格描述字段
- **且** 用户可以基于生成的描述进行修改
- **且** 提交表单
- **则** 新风格保存到 `data/styles/{style_id}/`
- **且** 元数据存储在 `meta.json` 中，包含名称、描述、参考图片路径
- **且** 参考图片保存为 `reference.jpg`（如果提供）
- **且** 用户重定向到风格列表页面

#### 场景：编辑现有风格
- **当** 用户查看风格列表
- **且** 在风格上点击"编辑"
- **且** 修改名称、描述或参考图片
- **且** 如果更新了参考图片，可以点击"生成风格描述"按钮重新生成描述
- **且** 保存更改
- **则** 风格元数据在 `meta.json` 中更新
- **且** 如果上传了新图片，新图片替换旧图片
- **且** 更改反映在风格列表中

#### 场景：删除风格
- **当** 用户查看风格列表
- **且** 在风格上点击"删除"
- **且** 确认删除
- **则** 风格文件夹及其所有内容从 `data/styles/{style_id}/` 移除
- **且** 风格从风格列表中移除

#### 场景：生成风格描述
- **当** 用户在创建或编辑风格时
- **且** 已上传参考图片
- **且** 点击"生成风格描述"按钮
- **则** 系统调用"图生风格描述"工具接口
- **且** 将参考图片作为输入
- **且** 返回生成的风格描述
- **且** 自动填充到风格描述字段
- **且** 用户可以基于生成的描述进行修改

### 需求：风格数据结构
系统必须为每个风格存储以下数据：
- 一个名称（必需）
- 一段风格描述（必需）
- 一张参考图片（可选）

风格数据存储在 `data/styles/{style_id}/` 目录：
- `meta.json`：风格元数据（名称、描述、参考图片文件名）
- `reference.jpg`：参考图片文件（如果提供）

#### 场景：风格元数据格式
- **当** 系统保存风格数据时
- **则** `meta.json` 包含以下字段：
  - `name`：风格名称（字符串）
  - `description`：风格描述（字符串）
  - `reference_image`：参考图片文件名（字符串，可选，如 "reference.jpg"）

### 需求：风格图片访问
系统必须提供 API 接口用于访问风格的参考图片。

#### 场景：获取风格参考图片
- **当** 前端需要显示风格的参考图片时
- **则** 调用 `GET /api/styles/{style_id}/image/{filename}` 接口
- **且** 接口返回图片文件，设置适当的 CORS 和缓存控制头
- **且** 如果图片不存在，返回 404 错误

