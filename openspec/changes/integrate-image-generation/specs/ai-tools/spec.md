# AI 工具

## 修改需求

### 需求：文生图工具
系统必须提供文生图工具，支持多个模型切换、分辨率选择和类型选择，根据用户输入的文字描述生成图片。

#### 场景：使用文生图工具
- **当** 用户在工具页面
- **且** 点击"文生图"工具卡片
- **则** 显示文生图表单
- **且** 表单包含文字输入框、类型选择（人物/场景/道具）、模型选择、分辨率比例选择、分辨率选择
- **当** 用户输入文字描述、选择类型、模型、比例和分辨率
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的图片
- **且** 生成结果保存到历史记录

#### 场景：模型切换
- **当** 用户在文生图工具表单中
- **且** 选择不同的模型（seedream4.5、wan2.6、nanopro）
- **则** 系统记录用户选择的模型
- **且** 提交任务时使用对应的模型 API
- **且** 默认使用 seedream4.5 模型

#### 场景：分辨率参数处理
- **当** 用户选择分辨率比例（1:1, 3:4, 4:3, 16:9, 9:16）和分辨率（1k、2k）
- **且** 选择的模型是 seedream 或 wan
- **则** 系统根据比例和分辨率计算宽高值（格式：`"1024*1024"`）
- **且** 调用 API 时传入 `size` 参数
- **当** 选择的模型是 banana
- **则** 系统直接使用比例和分辨率值
- **且** 调用 API 时传入 `aspect_ratio` 和 `resolution` 参数

#### 场景：API 调用
- **当** 系统需要生成图片时
- **且** 模型是 seedream4.5
- **则** 调用 `seedream_v4_5_text_to_image` 函数
- **且** 传入 `prompt` 和计算后的 `size` 参数
- **当** 模型是 wan2.6
- **则** 调用 `wan_2_6_text_to_image` 函数
- **且** 传入 `prompt` 和计算后的 `size` 参数
- **当** 模型是 nanopro
- **则** 调用 `nano_banana_pro_text_to_image` 函数
- **且** 传入 `prompt`、`aspect_ratio` 和 `resolution` 参数

## 新增需求

### 需求：图生图工具
系统必须提供图生图工具，支持多个模型切换、分辨率选择和多图片管理，根据用户上传的参考图片和文字描述生成新图片。

#### 场景：使用图生图工具
- **当** 用户在工具页面
- **且** 点击"图生图"工具卡片
- **则** 显示图生图表单
- **且** 表单包含文字输入框、多图片上传区域、模型选择、分辨率比例选择、分辨率选择
- **当** 用户输入文字描述、上传图片、选择模型、比例和分辨率
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的图片
- **且** 生成结果保存到历史记录

#### 场景：多图片上传和管理
- **当** 用户在图生图工具表单中
- **且** 点击上传按钮或粘贴图片
- **则** 图片添加到图片列表
- **且** 显示图片缩略图预览
- **且** 每个图片显示删除按钮
- **当** 用户点击删除按钮
- **则** 对应的图片从列表中移除
- **且** 更新预览显示

#### 场景：图片拖拽排序
- **当** 用户在图生图工具表单中
- **且** 拖拽图片缩略图
- **则** 显示拖拽状态（半透明、边框高亮）
- **且** 显示插入位置指示
- **当** 用户释放鼠标
- **则** 图片移动到新位置
- **且** 更新图片列表顺序
- **且** 提交时按照新的顺序提交图片

#### 场景：模型切换
- **当** 用户在图生图工具表单中
- **且** 选择不同的模型（seedream4.5、wan2.6、nanopro）
- **则** 系统记录用户选择的模型
- **且** 提交任务时使用对应的模型 API
- **且** 默认使用 seedream4.5 模型

#### 场景：分辨率参数处理
- **当** 用户选择分辨率比例（1:1, 3:4, 4:3, 16:9, 9:16）和分辨率（1k、2k）
- **且** 选择的模型是 seedream 或 wan
- **则** 系统根据比例和分辨率计算宽高值（格式：`"1024*1024"`）
- **且** 调用 API 时传入 `size` 参数
- **当** 选择的模型是 banana
- **则** 系统直接使用比例和分辨率值
- **且** 调用 API 时传入 `aspect_ratio` 和 `resolution` 参数

#### 场景：API 调用
- **当** 系统需要生成图片时
- **且** 模型是 seedream4.5
- **则** 调用 `seedream_v4_edit` 函数（已存在）
- **且** 传入 `prompt`、`images`（按顺序）和计算后的 `size` 参数
- **当** 模型是 wan2.6
- **则** 调用 `wan_2_6_image_edit` 函数
- **且** 传入 `prompt`、`images`（按顺序）和计算后的 `size` 参数
- **当** 模型是 nanopro
- **则** 调用 `nano_banana_pro_edit` 函数
- **且** 传入 `prompt`、`images`（按顺序）、`aspect_ratio` 和 `resolution` 参数

### 需求：工具列表 UI 优化
系统必须优化左侧工具列表的显示，缩小每个工具项的高度。

#### 场景：工具列表样式调整
- **当** 用户在工具页面
- **则** 左侧工具列表每个工具项的高度缩小 30%
- **且** 保持工具图标和名称的可读性
- **且** 保持工具列表的整体美观

