# 任务列表

## 后端实现

- [x] 1. **更新作品数据结构**
   - 在 `server/api/works.py` 的 `create_work` 函数中，添加默认的素材关联字段：
     - `character_materials: []`（人物素材ID列表）
     - `scene_materials: []`（场景素材ID列表）
     - `prop_materials: []`（道具素材ID列表）
   - 在 `update_work` 函数中，支持更新这些字段

- [ ] 2. **添加批量获取素材详情接口（可选）**
   - 在 `server/api/materials.py` 中添加接口，支持根据ID列表批量获取素材详情
   - 用于在作品详情页面显示关联的素材信息

## 前端实现

- [x] 3. **创建通用素材多选面板组件**
   - 创建新的对话框元素（或复用现有的 `material-select-dialog`）
   - 实现多选逻辑：
     - 使用数组存储选中的素材ID
     - 点击素材时切换选中状态（勾选/取消勾选）
     - 显示选中状态的视觉反馈（勾号图标）
   - 实现分类筛选：
     - 支持传入 `allowedTypes` 参数，限制显示的素材类型
     - 如果指定了类型，只显示对应的筛选标签
   - 添加"创建素材"按钮：
     - 点击后跳转到 `materials.html` 页面
     - 使用 URL 参数传递当前筛选的类型（如果有）
   - 添加"刷新"按钮：
     - 重新调用 `loadMaterialsForSelection` 加载素材列表
   - 实现确认选择：
     - 返回选中的素材ID数组
     - 通过回调函数传递给调用者

- [x] 4. **更新作品详情页面HTML**
   - 在 `apps/web/work-detail.html` 中添加素材管理区域：
     - 人物素材列表区域
     - 场景素材列表区域
     - 道具素材列表区域
   - 每个区域包含：
     - 标题和"添加素材"按钮
     - 素材列表显示（图片、名称、删除按钮）

- [x] 5. **实现作品详情页面的素材管理逻辑**
   - 在 `apps/web/js/works.js` 或新建 `work-detail.js` 中：
     - 加载作品时，获取关联的素材信息并显示
     - 实现"添加素材"按钮：
       - 打开多选面板，传入对应的素材类型
       - 确认后，将选中的素材添加到对应列表（去重）
       - 更新作品数据并保存
     - 实现删除素材功能：
       - 从列表中移除素材
       - 更新作品数据并保存
   - 实现素材列表渲染：
     - 显示素材图片、名称
     - 提供删除按钮

- [x] 6. **样式实现**
   - 为多选面板添加样式：
     - 选中状态的视觉反馈（勾号图标、边框高亮）
     - 素材列表的布局
   - 为作品详情页面的素材管理区域添加样式：
     - 素材列表的网格布局
     - 删除按钮的样式

## 测试

- [ ] 7. **测试素材多选面板**
   - 测试多选功能（勾选/取消勾选）
   - 测试分类筛选功能
   - 测试"创建素材"按钮跳转
   - 测试"刷新"按钮功能

- [ ] 8. **测试作品素材关联**
   - 测试添加人物素材
   - 测试添加场景素材
   - 测试添加道具素材
   - 测试去重功能（同一素材不能重复添加）
   - 测试删除素材功能
   - 测试保存和加载功能

