# 任务列表

## 1. 前端HTML结构
- [x] 在 `episode-edit.html` 中，在"剧本关联素材"区域和"分镜管理"区域之间添加预览面板HTML结构
- [x] 预览面板包含标题、关闭按钮和内容容器
- [x] 预览面板默认隐藏（`style="display: none;"`）

## 2. 预览逻辑实现
- [x] 修改 `showPreview` 函数，改为切换预览面板的显示/隐藏状态
- [x] 实现内容获取逻辑，按优先级获取每个分镜的内容：
  - 优先使用 `shot.current_video`（参考视频）
  - 其次使用 `shot.video`（视频tab的视频）
  - 最后使用 `shot.selected_image` 或第一张候选图片
- [x] 实现连续播放逻辑：
  - 视频：监听 `ended` 事件，自动播放下一个
  - 图片：使用 `setTimeout` 在指定时长后切换到下一个

## 3. 视频播放控制
- [x] 实现视频自动播放功能
- [x] 实现视频无缝切换（前一个结束后立即播放下一个）
- [x] 处理视频加载失败的情况，自动降级到下一个可用内容

## 4. 图片显示控制
- [x] 实现图片显示功能
- [x] 使用分镜的 `duration` 字段作为图片显示时长
- [x] 图片显示指定时长后自动切换到下一个分镜

## 5. 交互功能
- [x] 实现关闭按钮功能，点击后隐藏预览面板
- [x] 实现"预览剧集"按钮的切换逻辑（显示/隐藏）
- [x] 确保面板状态正确管理（显示时隐藏，隐藏时显示）

## 6. 样式和UI
- [x] 添加预览面板的CSS样式
- [x] 确保预览面板在页面中的位置正确（在关联素材和分镜管理之间）
- [x] 确保预览内容（视频/图片）的显示效果良好

## 7. 错误处理
- [x] 处理分镜没有内容的情况（显示占位符或跳过）
- [x] 处理视频/图片加载失败的情况
- [x] 处理分镜顺序问题，确保按正确顺序播放

## 8. 测试和验证
- [x] 测试预览面板的显示/隐藏功能
- [x] 测试视频连续播放功能
- [x] 测试图片定时切换功能
- [x] 测试内容优先级逻辑（参考视频 > 视频 > 图片）
- [x] 测试关闭按钮功能
