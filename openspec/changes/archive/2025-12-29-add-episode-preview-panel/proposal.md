# 添加剧集预览面板功能

## 变更 ID
`add-episode-preview-panel`

## 目的
在剧集编辑页面添加一个可切换的预览面板，显示在"剧本关联素材"和"分镜管理"之间，连续播放所有分镜的内容，提供更直观的剧集预览体验。

## 为什么
- 用户需要在不离开编辑页面的情况下快速预览整个剧集
- 当前的预览功能使用模态框，需要打开新窗口，体验不够流畅
- 用户希望能够随时查看预览，同时继续编辑分镜
- 预览面板可以关闭，不占用页面空间，需要时再打开

## 变更内容

### 1. 预览面板区域
- 在"剧本关联素材"和"分镜管理"之间添加一个可切换的预览面板区域
- 面板默认隐藏，点击"预览剧集"按钮时显示
- 面板包含关闭按钮，点击后隐藏面板
- 面板显示标题"剧集预览"

### 2. 预览内容逻辑
- 按分镜顺序连续播放/显示每个分镜的内容
- 内容优先级：
  1. 参考tab的视频（`shot.current_video`）
  2. 视频tab的视频（`shot.video`）
  3. 图片tab的图片（`shot.selected_image` 或第一张候选图片），显示时长等于分镜的预期时长（`shot.duration`）
- 如果分镜没有任何内容，显示占位符或跳过

### 3. 视频播放控制
- 使用HTML5 video元素播放视频
- 支持自动播放和连续播放
- 视频之间无缝切换（前一个视频结束后自动播放下一个）
- 如果使用图片，图片显示指定时长后自动切换到下一个分镜

### 4. 交互功能
- "预览剧集"按钮：切换预览面板的显示/隐藏状态
- 关闭按钮：隐藏预览面板
- 面板状态持久化：关闭后再次点击"预览剧集"按钮时重新显示

## 背景
- 项目已有"预览剧集"功能，使用模态框显示预览内容
- 分镜卡片支持参考视频、视频和图片三种内容类型
- 分镜数据结构包含 `current_video`、`video`、`selected_image`、`image_candidates` 等字段
- 分镜包含 `duration` 字段，表示预期时长

## 变更范围
- **前端代码**：
  - 修改 `apps/web/episode-edit.html`（添加预览面板HTML结构）
  - 修改 `apps/web/js/episode-edit.js`（修改预览逻辑，支持面板显示/隐藏和连续播放）
  - 修改 `apps/web/styles/`（添加预览面板样式）
- **规范**：
  - 修改 `openspec/specs/episode-management/spec.md`（更新预览功能需求）

## 技术细节
- 预览面板使用 `display: none/block` 控制显示/隐藏
- 视频播放使用HTML5 Video API，监听 `ended` 事件实现自动切换
- 图片显示使用 `setTimeout` 实现定时切换
- 需要处理视频加载失败的情况，自动降级到下一个可用内容
- 需要处理分镜顺序，确保按 `shot.order` 或数组顺序播放

