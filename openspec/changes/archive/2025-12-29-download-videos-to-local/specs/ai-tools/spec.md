# ai-tools Specification

## 修改需求

### 需求：视频下载到本地管理
系统必须将所有 AI 生成的视频下载到本地服务器进行管理，替换直接使用外部 URL 的方式。

#### 场景：视频生成后自动下载
- **当** 视频生成工具（vidu参考生视频、sora生视频、wan图生视频等）成功生成视频
- **且** AI 接口返回视频 URL
- **则** 系统自动从 URL 下载视频到本地服务器
- **且** 视频保存到 `data/tools/outputs/{tool_type}/{output_id}/video.mp4`
- **且** 任务输出中的 `video_url` 更新为本地路径（如 `/data/tools/outputs/{tool_type}/{output_id}/video.mp4`）
- **且** 历史记录中的 `video_url` 也更新为本地路径
- **且** 如果下载失败，记录错误日志但保留原始 URL

#### 场景：视频下载错误处理
- **当** 视频下载过程中发生错误（网络超时、磁盘空间不足等）
- **则** 系统记录错误日志
- **且** 任务输出和历史记录中保留原始外部 URL
- **且** 系统继续正常运行，不中断任务流程

#### 场景：历史记录视频访问
- **当** 用户查看历史记录中的视频
- **且** 视频 URL 是本地路径
- **则** 系统通过本地文件服务提供视频访问
- **且** 视频可以正常播放和预览

