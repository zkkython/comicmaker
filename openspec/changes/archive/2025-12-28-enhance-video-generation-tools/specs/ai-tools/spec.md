# ai-tools Specification - 视频生成工具增强

## 新增需求

### 需求：vidu 参考生视频工具
系统必须提供 vidu 参考生视频工具，用户上传最多7张图片、输入文字描述、选择分辨率和时长，系统使用 `vidu/reference-to-video-q2` 模型生成视频。

#### 场景：使用 vidu 参考生视频工具
- **当** 用户在工具页面
- **且** 点击"vidu参考生视频"工具卡片
- **则** 显示 vidu 参考生视频表单
- **且** 表单包含：
  - 多图片上传组件（最多7张，支持上传/粘贴/选择素材）
  - 图片拖拽排序功能
  - 图片删除功能
  - 文字描述输入框
  - 分辨率选择（1:1, 3:4, 4:3, 16:9, 9:16，默认16:9）
  - 分辨率选择（540p, 720p, 1080p）
  - 时长选择（1-10秒，默认5秒）
- **当** 用户上传图片（最多7张）、输入文字描述、选择分辨率和时长
- **且** 点击"生成"按钮
- **则** 系统将图片上传到 OSS 获取 URL
- **且** 按照页面上的图片顺序提交到 API
- **且** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

#### 场景：图片顺序管理
- **当** 用户在 vidu 参考生视频工具中上传多张图片
- **且** 拖拽图片调整顺序
- **则** 系统记录图片的新顺序
- **且** 提交时按照显示的顺序将图片 URL 传递给 API

#### 场景：图片数量限制
- **当** 用户在 vidu 参考生视频工具中上传图片
- **且** 图片数量已达到7张
- **则** 系统禁止继续添加图片
- **且** 显示提示信息

### 需求：sora 生视频工具
系统必须提供 sora 生视频工具，用户上传单张图片、输入文字描述、选择时长，系统使用 `openai/sora-2/image-to-video` 模型生成视频。

#### 场景：使用 sora 生视频工具
- **当** 用户在工具页面
- **且** 点击"sora生视频"工具卡片
- **则** 显示 sora 生视频表单
- **且** 表单包含：
  - 单图片上传组件（支持上传/粘贴/选择素材）
  - 文字描述输入框
  - 时长选择（4、8、12秒）
- **当** 用户上传图片、输入文字描述、选择时长
- **且** 点击"生成"按钮
- **则** 系统将图片上传到 OSS 获取 URL
- **且** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

### 需求：wan 图生视频工具
系统必须提供 wan 图生视频工具，用户上传单张图片、输入文字描述、选择模型版本、分辨率和时长，系统使用 `alibaba/wan-2.5/image-to-video` 或 `alibaba/wan-2.6/image-to-video` 模型生成视频。

#### 场景：使用 wan 图生视频工具
- **当** 用户在工具页面
- **且** 点击"wan图生视频"工具卡片
- **则** 显示 wan 图生视频表单
- **且** 表单包含：
  - 单图片上传组件（支持上传/粘贴/选择素材）
  - 文字描述输入框
  - 模型版本选择（2.5 或 2.6）
  - 分辨率选择（480p, 720p, 1080p）
  - 时长选择（3-10秒，默认5秒）
  - 是否生成音频选择（复选框）
- **当** 用户上传图片、输入文字描述、选择模型版本、分辨率和时长
- **且** 点击"生成"按钮
- **则** 系统将图片上传到 OSS 获取 URL
- **且** 根据选择的模型版本调用相应的 API
- **且** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

#### 场景：模型版本切换
- **当** 用户在 wan 图生视频工具中
- **且** 切换模型版本（2.5 或 2.6）
- **则** 系统根据选择的版本调用相应的 API
- **且** API 参数可能略有不同（如 wan-2.6 需要 `shot_type` 参数）

### 需求：历史记录视频显示
系统必须在历史记录列表中显示视频输出预览。

#### 场景：查看视频历史记录
- **当** 用户在工具页面查看历史记录
- **且** 历史记录的输出包含视频
- **则** 历史记录项显示视频预览（缩略图或第一帧）
- **且** 点击视频预览可以播放视频
- **且** 显示视频相关信息（时长、文件大小等，如果可用）

### 需求：做同款图片填充增强
系统必须在做同款时自动填充视频生成工具的图片输入。

#### 场景：视频工具做同款
- **当** 用户在历史记录中点击视频生成工具的"做同款"按钮
- **且** 原始输入包含图片（单图或多图）
- **则** 系统自动将图片填充到对应的图片输入组件
- **且** 图片预览正确显示
- **且** 用户无需重新上传图片即可修改参数重新生成

### 需求：生成过程查看详情
系统必须在视频生成过程中支持查看详情功能。

#### 场景：查看生成中任务详情
- **当** 视频生成任务处于"正在处理"状态
- **且** 用户点击"查看详情"按钮
- **则** 系统显示任务详情对话框
- **且** 详情包含：AI 接口的提示词、请求参数
- **且** 用户可以查看当前任务的输入配置

## 修改需求

### 需求：参考图生视频工具改为 vidu 参考生视频工具
系统必须将现有的"参考图生视频"工具改为"vidu参考生视频"工具，使用 `vidu/reference-to-video-q2` 模型。

#### 场景：工具重命名和实现
- **当** 系统加载工具列表
- **则** "参考图生视频"工具显示为"vidu参考生视频"
- **且** 工具 ID 从 `ref_image_to_video` 改为 `vidu_ref_image_to_video`
- **且** 工具实际调用 `vidu/reference-to-video-q2` API
- **且** 支持最多7张图片输入

### 需求：文生视频工具改为 wan 图生视频工具
系统必须将现有的"文生视频"工具改为"wan图生视频"工具，使用 `alibaba/wan-2.5/image-to-video` 或 `alibaba/wan-2.6/image-to-video` 模型。

#### 场景：工具重命名和实现
- **当** 系统加载工具列表
- **则** "文生视频"工具显示为"wan图生视频"
- **且** 工具 ID 从 `text_to_video` 改为 `wan_image_to_video`
- **且** 工具实际调用 `alibaba/wan-2.5/image-to-video` 或 `alibaba/wan-2.6/image-to-video` API
- **且** 需要图片输入（单图）
- **且** 支持模型版本选择

