## 修改需求

### 需求：剧集预览功能增强
系统必须在剧集编辑页面提供可切换的预览面板，显示在"剧本关联素材"和"分镜管理"之间，连续播放所有分镜的内容，并在视频/图片下方居中显示台词字幕。

#### 场景：显示预览面板
- **当** 用户在剧集编辑页面
- **且** 点击"预览剧集"按钮
- **且** 预览面板当前隐藏
- **则** 系统在"剧本关联素材"和"分镜管理"之间显示预览面板
- **且** 预览面板包含标题"剧集预览"和关闭按钮
- **且** 开始按顺序播放/显示所有分镜的内容

#### 场景：隐藏预览面板
- **当** 预览面板已显示
- **且** 用户点击预览面板的关闭按钮
- **则** 系统隐藏预览面板
- **且** 停止当前播放的内容
- **且** 清除当前显示的字幕

#### 场景：切换预览面板
- **当** 用户点击"预览剧集"按钮
- **且** 预览面板当前显示
- **则** 系统隐藏预览面板
- **且** 停止当前播放的内容
- **且** 清除当前显示的字幕
- **当** 用户再次点击"预览剧集"按钮
- **且** 预览面板当前隐藏
- **则** 系统显示预览面板
- **且** 重新开始播放所有分镜的内容

#### 场景：连续播放分镜内容
- **当** 预览面板已显示
- **则** 系统按分镜顺序连续播放/显示每个分镜的内容
- **且** 对于每个分镜，按以下优先级选择内容：
  1. **如果** 分镜有参考tab的视频（`current_video`），播放该视频
  2. **否则如果** 分镜有视频tab的视频（`video`），播放该视频
  3. **否则如果** 分镜有已选择的图片（`selected_image`），显示该图片持续分镜的预期时长（`duration`秒）
  4. **否则如果** 分镜有候选图片，显示第一张候选图片持续分镜的预期时长
- **且** 视频播放结束后自动播放下一个分镜的内容
- **且** 图片显示指定时长后自动切换到下一个分镜的内容
- **且** 如果分镜没有任何内容，跳过该分镜继续下一个

#### 场景：视频播放控制
- **当** 预览面板播放视频内容
- **则** 视频自动开始播放
- **且** 视频播放结束后（`ended` 事件），自动切换到下一个分镜的内容
- **且** 如果视频加载失败，自动切换到下一个分镜的内容

#### 场景：图片显示控制
- **当** 预览面板显示图片内容
- **则** 图片显示在预览区域
- **且** 图片持续显示分镜的预期时长（`duration` 秒）
- **且** 显示时长结束后，自动切换到下一个分镜的内容
- **且** 如果图片加载失败，显示占位符持续1秒后切换到下一个分镜

#### 场景：预览时缺少内容（预览面板）
- **当** 用户点击"预览剧集"
- **且** 某些分镜没有视频或图片
- **则** 这些分镜被跳过
- **且** 预览继续使用可用内容
- **且** 如果所有分镜都没有内容，显示提示信息："暂无可预览的内容"

#### 场景：显示台词字幕
- **当** 预览面板播放或显示分镜内容
- **且** 分镜包含 `dialogue_prompt` 字段
- **且** `dialogue_prompt` 不为空
- **则** 系统解析 `dialogue_prompt`，提取时间范围和对应的台词内容
- **且** 在视频/图片下方居中显示字幕容器
- **且** 根据当前播放时间或显示时间，动态显示对应的台词字幕
- **且** 字幕显示格式为：角色描述和台词内容（例如：【刘备，身着白色长袍，神情坚定】:"天若有情天亦老，"）

#### 场景：台词字幕时间同步
- **当** 预览面板播放视频内容
- **且** 分镜包含台词提示词
- **则** 系统监听视频的 `timeupdate` 事件
- **且** 当视频播放时间进入某个台词的时间范围时（例如：3～4秒），显示该台词字幕
- **且** 当视频播放时间离开某个台词的时间范围时，隐藏该台词字幕
- **且** 支持多个台词片段按时间顺序显示和隐藏

#### 场景：图片显示时的台词字幕
- **当** 预览面板显示图片内容
- **且** 分镜包含台词提示词
- **则** 系统根据图片显示的开始时间（从0秒开始）和持续时间（`duration` 秒）
- **且** 按时间顺序显示对应的台词字幕
- **且** 当图片显示时间进入某个台词的时间范围时，显示该台词字幕
- **且** 当图片显示时间离开某个台词的时间范围时，隐藏该台词字幕

#### 场景：分镜切换时的字幕清除
- **当** 预览面板切换到下一个分镜
- **则** 系统清除当前显示的字幕
- **且** 如果新分镜包含台词提示词，开始显示新分镜的字幕

#### 场景：没有台词提示词时的字幕显示
- **当** 预览面板播放或显示分镜内容
- **且** 分镜不包含 `dialogue_prompt` 字段
- **或** `dialogue_prompt` 为空字符串
- **则** 系统不显示字幕容器
- **且** 预览区域只显示视频或图片内容

#### 场景：台词解析失败处理
- **当** 预览面板尝试解析分镜的 `dialogue_prompt`
- **且** 台词提示词格式不正确或解析失败
- **则** 系统不显示字幕
- **或** 显示错误提示（可选）
- **且** 预览功能继续正常工作，不影响视频/图片的播放和显示

