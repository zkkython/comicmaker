# 任务列表

## 1. 后端：增加"其他"素材类型支持

- [x] 修改 `server/api/materials.py` 中的 `MATERIAL_TYPES`，增加 `"others"` 类型
- [x] 更新所有素材类型验证逻辑，确保支持 `"others"`
- [x] 测试创建、编辑、删除"其他"类型素材的 API

## 2. 前端：素材管理页面增加"其他"类型

- [x] 修改 `apps/web/materials.html`，在标签页中增加"其他"按钮
- [x] 修改 `apps/web/js/materials.js`，在 `typeNames` 中增加 `others: '其他'`
- [x] 测试"其他"类型素材的创建、编辑、删除功能

## 3. 前端：调整创建新素材面板宽度

- [x] 修改 `apps/web/styles/materials.css`，增加创建模态框的宽度（例如从 600px 增加到 800px）
- [x] 确保在不同屏幕尺寸下显示正常

## 4. 后端：素材列表接口支持按类型筛选

- [x] 检查 `server/api/materials.py` 的 `list_materials` 接口是否已支持按类型筛选
- [x] 如果需要，增加按类型筛选的逻辑
- [x] 确保返回的素材列表包含完整的元数据（名称、描述、主图路径等）

## 5. 前端：图生图工具增加"选择素材"按钮

- [x] 修改 `apps/web/js/tools.js`，在图生图工具的图片上传组件区域增加"选择素材"按钮
- [x] 按钮应位于"上传图片"和"粘贴图片"按钮附近
- [x] 点击按钮时打开素材选择面板

## 6. 前端：实现素材选择面板

- [x] 在 `apps/web/tools.html` 中增加素材选择面板的 `<dialog>` 元素
- [x] 面板应包含：
  - 标题栏（"选择素材"）
  - 5个筛选标签：全部、人物、场景、道具、其他
  - 素材网格列表（1:1 显示，保证完整显示）
  - 每个素材格子包含图片预览和"详情"按钮
  - 底部操作栏："选择"和"取消"按钮
- [x] 实现面板的打开和关闭逻辑

## 7. 前端：实现素材列表渲染

- [x] 在 `apps/web/js/tools.js` 中实现 `loadMaterialsForSelection` 函数
- [x] 根据选中的筛选标签加载对应类型的素材列表
- [x] 渲染素材网格，每个素材以 1:1 比例显示（使用 `object-fit: contain` 保证完整显示）
- [x] 支持横版和竖版图片的完整显示

## 8. 前端：实现素材详情查看

- [x] 在素材选择面板中，为每个素材格子增加"详情"按钮
- [x] 点击"详情"按钮时，打开详情面板（使用 `<dialog>` 元素）
- [x] 详情面板显示：
  - 素材大图（主图）
  - 素材名称
  - 素材描述
  - 右上角关闭按钮
- [x] 实现详情面板的打开和关闭逻辑

## 9. 前端：实现素材选择功能

- [x] 在素材选择面板中，点击素材格子时标记为选中状态（视觉反馈）
- [x] 支持单选（一次只能选中一个素材）
- [x] 点击"选择"按钮时：
  - 获取选中素材的主图路径
  - 将图片添加到图生图工具的图片上传组件中
  - 关闭素材选择面板
- [x] 点击"取消"按钮时关闭面板，不进行任何操作

## 10. 前端：优化历史记录"做同款"功能

- [x] 修改 `apps/web/js/tools.js` 中的 `reuseHistory` 函数
- [x] 当历史记录的输入包含图片时（`image_path`、`image_paths`、`images` 等字段）：
  - 检测是否为图生图工具（`image_to_image`）
  - 如果是，将图片路径转换为可用的图片对象
  - 填充到图生图工具的图片上传组件中
- [x] 确保图片正确显示在预览区域
- [x] 测试各种图片输入字段的处理

## 11. 样式：素材选择面板样式

- [x] 在 `apps/web/styles/tools.css` 中增加素材选择面板的样式
- [x] 样式包括：
  - 面板布局（大尺寸，居中显示）
  - 筛选标签样式
  - 素材网格布局（响应式，1:1 比例）
  - 素材选中状态样式
  - 详情按钮样式
  - 底部操作栏样式
- [x] 确保图片在 1:1 容器中完整显示（不裁剪）

## 12. 样式：素材详情面板样式

- [x] 在 `apps/web/styles/tools.css` 中增加素材详情面板的样式
- [x] 样式包括：
  - 面板布局
  - 大图显示区域（保证完整显示）
  - 名称和描述文本样式
  - 关闭按钮位置和样式

## 13. 测试验证

- [x] 测试"其他"类型素材的完整流程（创建、编辑、删除、列表显示）
- [x] 测试图生图工具的素材选择功能
- [x] 测试素材选择面板的筛选功能
- [x] 测试素材详情查看功能
- [x] 测试历史记录"做同款"功能的图片填充
- [x] 测试不同尺寸图片的显示效果（横版、竖版、正方形）
- [x] 测试创建新素材面板的宽度调整效果

