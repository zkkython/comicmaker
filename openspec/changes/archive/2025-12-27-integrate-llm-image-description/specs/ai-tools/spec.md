# AI 工具

## Purpose
提供统一的 AI 工具界面，包含多个 AI 生成工具，支持异步任务处理、状态轮询和历史记录管理。

## 修改需求

### 需求：基于图生描述工具
系统必须使用 OpenRouter LLM 接口根据用户上传的图片和描述生成详细的描述设定，替换现有的 mock 实现。

#### 场景：使用 LLM 生成图片描述
- **当** 用户在工具页面使用"基于图生描述"工具
- **且** 上传图片、选择类型（人物/场景/道具）并可选提供额外描述
- **且** 点击"生成"按钮
- **则** 系统加载提示词模板文件 `server/prompts/generation/image_to_description.txt`
- **且** 将图片编码为 base64 格式
- **且** 将用户选择的类型和描述替换到提示词模板的变量位置
- **且** 从配置文件读取 LLM 配置（模型、API Key）
- **且** 调用 OpenRouter LLM 接口（支持多模态输入：图片 + 文本）
- **且** 返回生成的详细描述文本（100字以内）
- **且** 如果 LLM 调用失败，任务状态标记为失败并返回错误信息

#### 场景：提示词模板管理
- **当** 系统需要生成图片描述时
- **则** 从 `server/prompts/generation/image_to_description.txt` 加载提示词模板
- **且** 提示词使用中文编写
- **且** 提示词包含变量占位符（如 `{material_type}`、`{user_description}`）用于替换用户输入
- **且** 提示词应包含系统角色定义、任务目标和输出要求
- **且** 根据用户选择的类型（人物/场景/道具）调整描述重点

#### 场景：多模态输入处理
- **当** 系统需要调用 LLM 接口生成图片描述时
- **则** 将图片文件编码为 base64 格式
- **且** 构建多模态消息（包含图片和文本提示词）
- **且** 如果用户提供了额外描述，将其包含在用户消息中
- **且** 使用 OpenRouter API 的多模态能力处理图片和文本输入

#### 场景：LLM 配置读取
- **当** 系统需要调用 LLM 接口时
- **则** 从 `server/config/config.yaml` 读取 `llm` 配置
- **且** 获取 `model` 字段（LLM 模型名称，需支持多模态）
- **且** 获取 `openai_api_key` 字段（OpenRouter API Key）
- **且** 使用这些配置调用 OpenRouter API

