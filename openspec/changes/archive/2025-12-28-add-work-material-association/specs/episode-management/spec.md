# episode-management Specification - 作品素材关联

## 修改需求

### 需求：作品详情编辑
系统必须在作品详情编辑页面添加素材关联功能，允许用户为作品关联人物、场景和道具素材。

#### 场景：查看作品关联的素材
- **当** 用户在作品详情编辑页面
- **则** 页面显示三个素材管理区域：
  - 人物素材列表
  - 场景素材列表
  - 道具素材列表
- **且** 每个区域显示当前作品关联的该类型素材列表
- **且** 每个素材显示图片、名称和删除按钮
- **且** 如果某个类型没有关联素材，显示"暂无素材"提示

#### 场景：添加人物素材
- **当** 用户在作品详情编辑页面
- **且** 点击"添加人物素材"按钮
- **则** 系统打开素材多选面板
- **且** 多选面板只显示人物类型的素材（筛选标签只显示"人物"或隐藏筛选标签）
- **当** 用户选择一个或多个素材
- **且** 点击"确认"按钮
- **则** 系统将选中的素材添加到作品的人物素材列表
- **且** 如果某些素材已经在列表中，自动去重（不重复添加）
- **且** 更新页面显示，显示新添加的素材
- **且** 保存作品数据到后端

#### 场景：添加场景素材
- **当** 用户在作品详情编辑页面
- **且** 点击"添加场景素材"按钮
- **则** 系统打开素材多选面板
- **且** 多选面板只显示场景类型的素材
- **当** 用户选择一个或多个素材
- **且** 点击"确认"按钮
- **则** 系统将选中的素材添加到作品的场景素材列表
- **且** 自动去重
- **且** 更新页面显示
- **且** 保存作品数据到后端

#### 场景：添加道具素材
- **当** 用户在作品详情编辑页面
- **且** 点击"添加道具素材"按钮
- **则** 系统打开素材多选面板
- **且** 多选面板只显示道具类型的素材
- **当** 用户选择一个或多个素材
- **且** 点击"确认"按钮
- **则** 系统将选中的素材添加到作品的道具素材列表
- **且** 自动去重
- **且** 更新页面显示
- **且** 保存作品数据到后端

#### 场景：删除关联的素材
- **当** 用户在作品详情编辑页面
- **且** 在某个素材项上点击"删除"按钮
- **且** 确认删除
- **则** 系统从对应类型的素材列表中移除该素材
- **且** 更新页面显示
- **且** 保存作品数据到后端

#### 场景：素材去重
- **当** 用户添加素材到作品
- **且** 选中的素材中有些已经在对应类型的列表中
- **则** 系统自动过滤掉已存在的素材
- **且** 只添加新的素材
- **且** 如果所有选中的素材都已存在，显示提示信息

### 需求：作品数据结构扩展
系统必须在作品的元数据中存储关联的素材ID列表。

#### 场景：创建作品时的默认数据
- **当** 系统创建新作品时
- **则** 在 `meta.json` 中包含以下字段：
  - `character_materials: []`（人物素材ID列表）
  - `scene_materials: []`（场景素材ID列表）
  - `prop_materials: []`（道具素材ID列表）

#### 场景：更新作品素材关联
- **当** 用户添加或删除素材关联
- **且** 保存作品数据
- **则** 系统更新 `meta.json` 中对应的素材ID列表
- **且** 保持其他字段不变

#### 场景：加载作品素材关联
- **当** 系统加载作品详情时
- **则** 从 `meta.json` 读取素材ID列表
- **且** 根据ID列表获取素材详情
- **且** 如果某个素材不存在（可能已被删除），跳过该素材或显示占位符
- **且** 在页面上显示素材列表

