# 任务列表

## 阶段1：修改生成分镜脚本工具

- [x] 1.1 修改工具名称和ID（`generate_storyboard` -> `generate_single_shot_storyboard`）
- [x] 1.2 添加输入字段：预期时长（默认60秒）、单镜头预计时间（1-6秒下拉框）
- [x] 1.3 添加素材选择功能（人物、场景、道具三个列表，复用素材多选面板）
- [x] 1.4 创建/修改提示词模板文件，包含素材列表、时长计算要求
- [x] 1.5 修改后端API，接收新参数并传递给LLM
- [x] 1.6 实现输出解析逻辑（解析关联素材、分镜描述、关联素材、时长）
- [x] 1.7 前端实现结构化展示（关联素材列表、分镜列表）

## 阶段2：剧集编辑页面增强

- [x] 2.1 修改"生成分镜脚本"按钮为"生成单镜头分镜脚本"
- [x] 2.2 添加"生成多镜头分镜脚本"按钮（预留，暂时不实现功能）
- [x] 2.3 实现调用生成单镜头分镜脚本工具的逻辑
- [x] 2.4 实现分镜脚本解析逻辑（文本解析为结构化数据）
- [x] 2.5 实现分镜卡片创建和填充数据
- [x] 2.6 实现剧本关联素材列表显示（可点击查看详情）
- [x] 2.7 实现解析失败的错误提示

## 阶段3：新增生成分镜提示词工具

- [x] 3.1 创建工具定义（ID: `generate_shot_prompts`）
- [x] 3.2 添加输入字段：关联素材列表（多选）、分镜描述、预期时长（1-12秒）
- [x] 3.3 创建提示词模板文件（要求输出5个提示词）
- [x] 3.4 实现后端API（调用LLM接口）
- [x] 3.5 实现输出解析逻辑（解析5个提示词）
- [x] 3.6 前端实现结构化展示（5个提示词分别显示）

## 阶段4：分镜卡片迭代

- [x] 4.1 添加预期时长字段（1-6秒下拉框，默认显示生成的分镜时长）
- [x] 4.2 添加"生成提示词"按钮
- [x] 4.3 实现调用生成分镜提示词工具的逻辑
- [x] 4.4 实现提示词填充到对应tab的逻辑
- [x] 4.5 添加"参考"tab到分镜卡片
- [x] 4.6 实现参考视频生成功能（调用vidu参考生视频工具）
- [x] 4.7 实现视频任务关联到分镜卡片
- [x] 4.8 实现视频历史管理（历史列表、预览播放、切换视频）
- [x] 4.9 实现离开页面后任务状态查询和视频关联

## 验证

- [x] 测试生成单镜头分镜脚本工具（包含素材选择、时长计算）
- [x] 测试分镜脚本解析和结构化展示
- [x] 测试生成分镜提示词工具（5个提示词输出）
- [x] 测试分镜卡片预期时长编辑
- [x] 测试分镜卡片生成提示词功能
- [x] 测试参考视频生成和历史管理

