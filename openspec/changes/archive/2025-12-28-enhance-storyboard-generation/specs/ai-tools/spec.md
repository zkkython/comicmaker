## 修改需求
### 需求：生成分镜脚本工具
系统必须提供生成单镜头分镜脚本工具，用户输入剧本文本、预期时长、单镜头时长和关联素材，系统生成格式化的分镜脚本。

#### 场景：使用生成单镜头分镜脚本工具
- **当** 用户在工具页面
- **且** 点击"生成单镜头分镜脚本"工具卡片
- **则** 显示生成分镜脚本表单
- **且** 表单包含以下输入字段：
  - 剧本文本输入框（必填）
  - 预期时长输入框（默认60秒，必填）
  - 单镜头预计时间下拉框（1-6秒可选，必填）
  - 人物素材列表（显示已选择的素材，支持添加和删除）
  - 场景素材列表（显示已选择的素材，支持添加和删除）
  - 道具素材列表（显示已选择的素材，支持添加和删除）
- **当** 用户输入剧本文本、设置时长、选择素材
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的分镜脚本（格式化文本）
- **且** 生成结果保存到历史记录

#### 场景：选择关联素材
- **当** 用户在生成单镜头分镜脚本工具表单中
- **且** 点击"添加人物素材"、"添加场景素材"或"添加道具素材"按钮
- **则** 系统打开素材多选面板
- **且** 多选面板只显示对应类型的素材（人物/场景/道具）
- **当** 用户选择一个或多个素材
- **且** 点击"确认"按钮
- **则** 系统将选中的素材添加到对应类型的素材列表
- **且** 自动去重（不重复添加已存在的素材）
- **且** 更新页面显示

#### 场景：生成分镜脚本的提示词构建
- **当** 系统需要生成分镜脚本时
- **则** 从 `server/prompts/generation/single_shot_storyboard.txt` 加载提示词模板
- **且** 将以下内容替换到提示词模板：
  - `{script}`：用户输入的剧本文本
  - `{expected_duration}`：预期时长（秒）
  - `{shot_duration}`：单镜头预计时间（秒）
  - `{character_materials}`：人物素材名称列表（格式：素材1，素材2，...）
  - `{scene_materials}`：场景素材名称列表（格式：素材1，素材2，...）
  - `{prop_materials}`：道具素材名称列表（格式：素材1，素材2，...）
- **且** 提示词要求AI：
  - 根据预期时长和单镜头时长计算分镜数量
  - 基于剧本和素材列表，选择需要关联的素材
  - 严格按照格式输出（第一行：剧本关联素材，后续每4行为一个分镜：分镜N、关联素材、时长）

#### 场景：分镜脚本输出格式
- **当** LLM返回分镜脚本文本
- **则** 输出格式必须为：
  ```
  剧本关联素材：素材1，素材2，素材3
  分镜1: 分镜描述文本
  关联素材: 素材1，素材2
  时长: 5
  分镜2: 分镜描述文本
  关联素材: 素材3
  时长: 6
  ```
- **且** 系统解析输出文本，提取：
  - 剧本关联素材列表（第一行）
  - 每个分镜的描述、关联素材、时长

#### 场景：分镜脚本结构化展示
- **当** 分镜脚本生成完成
- **则** 在工具输出区域显示：
  - 剧本关联素材列表（可点击查看详情）
  - 分镜列表（每个分镜显示描述、关联素材、时长）
- **且** 如果解析失败，显示错误提示

## 新增需求
### 需求：生成分镜提示词工具
系统必须提供生成分镜提示词工具，用户输入关联素材、分镜描述和预期时长，系统生成5个提示词（图片、视频、参考视频、音频、台词）。

#### 场景：使用生成分镜提示词工具
- **当** 用户在工具页面
- **且** 点击"生成分镜提示词"工具卡片
- **则** 显示生成分镜提示词表单
- **且** 表单包含以下输入字段：
  - 关联素材列表（多选，支持素材选择面板，显示已选择的素材）
  - 分镜描述输入框（必填）
  - 预期时长下拉框（1-12秒可选，必填）
- **当** 用户输入分镜描述、选择素材、设置时长
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的5个提示词
- **且** 生成结果保存到历史记录

#### 场景：选择关联素材
- **当** 用户在生成分镜提示词工具表单中
- **且** 点击"添加素材"按钮
- **则** 系统打开素材多选面板
- **且** 多选面板显示所有类型的素材（全部、人物、场景、道具、其他）
- **当** 用户选择一个或多个素材
- **且** 点击"确认"按钮
- **则** 系统将选中的素材添加到关联素材列表
- **且** 自动去重
- **且** 更新页面显示

#### 场景：生成分镜提示词的提示词构建
- **当** 系统需要生成分镜提示词时
- **则** 从 `server/prompts/generation/shot_prompts.txt` 加载提示词模板
- **且** 将以下内容替换到提示词模板：
  - `{related_materials}`：关联素材名称列表（格式：素材1，素材2，...）
  - `{shot_description}`：分镜描述文本
  - `{duration}`：预期时长（秒）
- **且** 提示词要求AI：
  - 在图片提示词中按顺序描述素材的使用方式（素材1也就是图1需要干什么，素材2也就是图2需要干什么）
  - 在视频提示词中描述图生视频的过程，加入运镜描述、人物、特效等详细描述
  - 在参考视频提示词中按顺序描述素材的使用方式
  - 在音频提示词中描述应该生成什么样的音频来配合视频，根据时间描述出来
  - 在台词提示词中基于分镜描述的台词和对应角色，说的话根据时间描述出来
  - 严格按照格式输出（5个提示词分别以"分镜图片提示词:"、"分镜视频提示词:"等开头）

#### 场景：分镜提示词输出格式
- **当** LLM返回分镜提示词文本
- **则** 输出格式必须为：
  ```
  分镜图片提示词: 提示词内容
  分镜视频提示词: 提示词内容
  参考视频提示词: 提示词内容
  音频提示词: 提示词内容
  台词提示词: 提示词内容
  ```
- **且** 系统解析输出文本，提取5个提示词

#### 场景：分镜提示词结构化展示
- **当** 分镜提示词生成完成
- **则** 在工具输出区域显示5个提示词：
  - 分镜图片提示词
  - 分镜视频提示词
  - 参考视频提示词
  - 音频提示词
  - 台词提示词
- **且** 如果解析失败，显示错误提示

