# AI 工具

## Purpose
提供统一的 AI 工具界面，包含多个 AI 生成工具，支持异步任务处理、状态轮询和历史记录管理。

## 新增需求

### 需求：工具页面导航
系统必须在主要页面添加"工具"Tab，用户可以导航到工具页面。

#### 场景：访问工具页面
- **当** 用户在主要页面
- **且** 点击导航栏中的"工具"链接
- **则** 用户导航到工具页面
- **且** 工具页面显示所有可用的 AI 工具

### 需求：生成剧本工具
系统必须提供生成剧本工具，用户输入文本描述，系统生成详细的剧本文本。

#### 场景：使用生成剧本工具
- **当** 用户在工具页面
- **且** 点击"生成剧本"工具卡片
- **则** 显示生成剧本表单
- **且** 表单包含文本描述输入框
- **当** 用户输入文本描述
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的剧本文本
- **且** 生成结果保存到历史记录

### 需求：生成分镜脚本工具
系统必须提供生成分镜脚本工具，用户输入剧本文本，系统生成分镜脚本。

#### 场景：使用生成分镜脚本工具
- **当** 用户在工具页面
- **且** 点击"生成分镜脚本"工具卡片
- **则** 显示生成分镜脚本表单
- **且** 表单包含剧本文本输入框
- **当** 用户输入剧本文本
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的分镜脚本（格式：分镜1: ... 分镜2: ...）
- **且** 生成结果保存到历史记录

### 需求：基于图生描述工具
系统必须提供基于图生描述工具，用户上传图片并选择类型（人物/场景/道具），系统生成描述文本。

#### 场景：使用基于图生描述工具
- **当** 用户在工具页面
- **且** 点击"基于图生描述"工具卡片
- **则** 显示图生描述表单
- **且** 表单包含图片上传和类型选择（人物/场景/道具）
- **当** 用户上传图片并选择类型
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的描述文本
- **且** 生成结果保存到历史记录

### 需求：文生图工具
系统必须提供文生图工具，用户输入文字描述并选择类型（人物/场景/道具），系统生成图片。

#### 场景：使用文生图工具
- **当** 用户在工具页面
- **且** 点击"文生图"工具卡片
- **则** 显示文生图表单
- **且** 表单包含文字输入框和类型选择（人物/场景/道具）
- **当** 用户输入文字描述并选择类型
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的图片
- **且** 生成结果保存到历史记录

### 需求：文生视频工具
系统必须提供文生视频工具，用户输入文字描述、选择分辨率（9:16/16:9/4:3/3:4）和时长，系统生成视频。

#### 场景：使用文生视频工具
- **当** 用户在工具页面
- **且** 点击"文生视频"工具卡片
- **则** 显示文生视频表单
- **且** 表单包含文字输入框、分辨率选择和时长输入
- **当** 用户输入文字描述、选择分辨率和时长
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

### 需求：参考图生视频工具
系统必须提供参考图生视频工具，用户上传若干张图片、输入文字描述、选择分辨率和时长，系统生成视频。

#### 场景：使用参考图生视频工具
- **当** 用户在工具页面
- **且** 点击"参考图生视频"工具卡片
- **则** 显示参考图生视频表单
- **且** 表单包含多图片上传、文字输入框、分辨率选择和时长输入
- **当** 用户上传图片、输入文字描述、选择分辨率和时长
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

### 需求：首尾帧生视频工具
系统必须提供首尾帧生视频工具，用户上传2张图片作为首尾帧、输入文字描述、选择分辨率和时长，系统生成视频。

#### 场景：使用首尾帧生视频工具
- **当** 用户在工具页面
- **且** 点击"首尾帧生视频"工具卡片
- **则** 显示首尾帧生视频表单
- **且** 表单包含首帧图片上传、尾帧图片上传、文字输入框、分辨率选择和时长输入
- **当** 用户上传2张图片、输入文字描述、选择分辨率和时长
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的视频
- **且** 生成结果保存到历史记录

### 需求：生音频工具
系统必须提供生音频工具，用户输入文字描述和选择时长，系统生成音频。

#### 场景：使用生音频工具
- **当** 用户在工具页面
- **且** 点击"生音频"工具卡片
- **则** 显示生音频表单
- **且** 表单包含文字输入框和时长输入
- **当** 用户输入文字描述和时长
- **且** 点击"生成"按钮
- **则** 系统创建任务并返回任务ID
- **且** 前端开始轮询任务状态
- **且** 任务完成后显示生成的音频播放器
- **且** 生成结果保存到历史记录

### 需求：异步任务管理
系统必须为每个工具调用创建异步任务，支持任务状态查询和结果获取。

#### 场景：创建任务
- **当** 用户提交工具表单
- **则** 系统创建任务并返回任务ID
- **且** 任务状态初始为"请求中"（pending）
- **且** 后台异步执行 AI 调用

#### 场景：查询任务状态
- **当** 前端轮询任务状态
- **且** 调用任务状态查询接口
- **则** 系统返回当前任务状态（请求中/成功/失败）
- **且** 如果任务失败，返回错误信息
- **且** 如果任务成功，返回进度信息（可选）

#### 场景：获取任务结果
- **当** 任务状态为"成功"
- **且** 前端调用结果获取接口
- **则** 系统返回完整的输出结果
- **且** 结果包含生成的内容（文本/图片/视频/音频）和元数据

### 需求：状态轮询
系统必须支持前端对任务状态进行轮询。

#### 场景：轮询任务状态
- **当** 任务创建后
- **则** 前端每2秒轮询一次任务状态
- **且** 如果任务状态为"请求中"，继续轮询
- **且** 如果任务状态为"成功"或"失败"，停止轮询
- **且** 如果轮询超过5分钟，停止轮询并提示超时

### 需求：历史记录管理
系统必须记录所有工具生成任务，提供历史记录查看、删除和复用功能。

#### 场景：查看历史记录列表
- **当** 用户在工具页面
- **且** 点击"历史记录"标签
- **则** 显示所有历史记录列表
- **且** 每个记录显示：工具类型、生成时间、输入预览
- **且** 支持按工具类型筛选
- **且** 支持分页显示

#### 场景：查看历史记录详情
- **当** 用户在历史记录列表中
- **且** 点击"查看详情"按钮
- **则** 显示历史记录详情
- **且** 详情包含：工具类型、输入参数、输出结果、生成时间、任务状态
- **且** 如果输出是图片/视频/音频，显示预览

#### 场景：删除历史记录
- **当** 用户在历史记录列表中
- **且** 点击"删除"按钮
- **且** 确认删除
- **则** 历史记录被删除
- **且** 相关的生成内容文件也被删除（可选）

#### 场景：做同款
- **当** 用户在历史记录列表中
- **且** 点击"做同款"按钮
- **则** 系统跳转到对应的工具表单
- **且** 表单中的输入字段自动填充历史记录中的输入参数
- **且** 用户可以修改输入后重新生成

